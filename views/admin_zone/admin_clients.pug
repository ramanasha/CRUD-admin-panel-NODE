extends admin_layout.pug
block content
    .container
        .admin-icons.text-center.py-2
            a(href="/admin").mr-2.active.text-warning Volver al panel de administración
                i.fa.fa-2x.fa-fw.fa-cogs
            a(href="/admin/").ml-1
                i.fa.fa-2x.fa-fw.fa-envelope
                span.badge.badge-danger.py-1 0
    div.dropdown-divider
    .container
        .row
            .col-12.col-lg-10.offset-lg-1
                table.table.table-responsive.table-bordered.table-striped
                    thead 
                        tr
                            th(scope="row").bg-inverse.text-white.font-weight-bold *
                            th Nombre Completo
                            th Teléfonos contacto
                            th Email de contacto
                            th Mascotas

                    tbody
                    each client, index in clients
                        tr
                            td
                                button.btn(type='button', data-toggle='modal', data-target='#client' + index).alone-buttons
                                    i.fa.fa-eye.fa-fw.text-success
                                button.btn(type='button').alone-buttons
                                    i.fa.fa-pencil.fa-fw.text-warning
                                button(type="button" title="Añadir nueva mascota" data-toggle='modal', data-target="#newPet" + client._id).alone-buttons
                                    i.fa.fa-fw.fa-paw.text-danger
                            td= client.personal.name
                            td#phones= client.contact.phoneOne + "/" + client.contact.phoneTwo        
                            td= client.contact.email
                            td= client.pets
                          


    each client, index in clients        
        include ../partials/modal_client.pug 
        include ../partials/modal_new_pet.pug

block scripts
    script(src='https://code.jquery.com/jquery-3.2.1.min.js', integrity='sha256-hwg4gsxgFZhOsEEamdOYGBf13FyQuiTwlAQgxVSNgt4=', crossorigin='anonymous')
    script(src='https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-alpha.6/js/bootstrap.min.js', integrity='sha384-vBWWzlZJ8ea9aCX4pEW3rVHjgjt7zpkNpZk+02D9phzyeVkE+jo0ieGizqPLForn', crossorigin='anonymous')
    script.
        $(function() {
            $('.card-footer').find('form').on('submit', function(event) {
                return confirm('¿Estás seguro de querer borrarlo?')  
            });
            $('div.vaccine').find('button').on('click', function() { 
                let liPosition = $(this).parent().next('.list-group').children().length;
                let $list_item = $('<li>', {class:"list-group-item"}),
                $input_item = $('<input />',
                {class:"form-control", 
                type: "text",
                placeholder:"Nueva vacuna",
                name: `vaccine${liPosition}`});

                    $list_item.append($input_item)
                    let $list_group = $(this).parent().next('.list-group')
                    $list_item.appendTo($list_group)
                    $(this).parent().find('#vaccines').attr("value", liPosition + 1 )  
            })

                $('form#newPet').on('submit', function(event) {
                    let vaccinesGroup = JSON.stringify($(`#vaccineGroup input`).serializeArray());
                    $('#vaccines').attr("value", vaccinesGroup)
                    let diseasesGroup = JSON.stringify($(`#diseasesGroup input`).serializeArray());
                    $('#diseases').attr("value", diseasesGroup)
                })

            $('div.diseases').find('button').on('click', function() {
                let liPosition = $(this).parent().next('.list-group').children().length;
                let $list_item = $('<li>', {class:"list-group-item"}),
                $input_item = $('<input />',
                {class:"form-control", 
                type: "text",
                placeholder:"Nueva Enfermedad",
                name: `disease${liPosition}`});

                    $list_item.append($input_item)
                    let $list_group = $(this).parent().next('.list-group')
                    $list_item.appendTo($list_group)
                    $(this).parent().find('#diseases').attr("value", liPosition + 1 )

            })
        })
